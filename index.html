<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>LOGi Trip</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Mobile-first design */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Prompt', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 100, 0.1);
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 16px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        header h1 i {
            font-size: 1.3rem;
        }
        
        /* Mobile Tab Navigation */
        .mobile-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 70px;
            z-index: 9;
            background: #f8faff;
        }
        
        .tab-btn {
            flex: 1;
            padding: 14px 8px;
            border: none;
            background: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .tab-btn i {
            font-size: 1rem;
        }
        
        .tab-btn.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            background: white;
        }
        
        .panel {
            display: none;
            padding: 16px;
            background: white;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }
        
        .panel.active {
            display: block;
        }
        
        /* Form styles */
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            color: #2a5298;
            font-size: 1.1rem;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f4ff;
        }
        
        .section-title i {
            margin-right: 8px;
            font-size: 1.1rem;
            width: 24px;
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        label i {
            color: #2a5298;
            width: 18px;
        }
        
        input, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.2s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }
        
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232a5298' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            padding-right: 44px;
            cursor: pointer;
        }
        
        input:focus, select:focus {
            border-color: #2a5298;
            outline: none;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        /* Time inputs */
        .time-input-container, .departure-time-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 8px;
            align-items: center;
        }
        
        .time-input-group, .departure-time-group {
            position: relative;
        }
        
        .time-input-group input, .departure-time-group input {
            padding-left: 45px;
            text-align: center;
        }
        
        .time-input-group:after, .departure-time-group:after {
            content: attr(data-label);
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 600;
            font-size: 0.85rem;
            padding: 2px 6px;
            border-radius: 4px;
            pointer-events: none;
        }
        
        .time-separator {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2a5298;
        }
        
        .hint-text {
            font-size: 0.75rem;
            color: #888;
            font-style: italic;
            margin-top: 6px;
        }
        
        /* ===== CHECKBOX STYLES - แก้ไขให้เห็นติ๊กถูก ===== */
        .calc-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-option:active {
            background: #e0e7ff;
            border-color: #2a5298;
        }
        
        /* ซ่อน checkbox จริง */
        .calc-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
            pointer-events: none;
        }
        
        /* สร้าง checkbox ปลอม */
        .calc-option label {
            position: relative;
            margin-bottom: 0;
            font-weight: 600;
            color: #2a5298;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            padding-left: 35px; /* เว้นที่สำหรับ checkbox ปลอม */
            min-height: 24px;
        }
        
        /* checkbox ปลอม */
        .calc-option label:before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border: 2px solid #2a5298;
            background: white;
            border-radius: 6px;
        }
        
        /* เมื่อ checkbox ถูกเลือก */
        .calc-option input[type="checkbox"]:checked + label:before {
            background: #2a5298;
        }
        
        /* แสดงเครื่องหมายถูก */
        .calc-option input[type="checkbox"]:checked + label:after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            left: 7px;
            top: 50%;
            transform: translateY(-50%);
            color: white;
        }
        
        /* Hover effect */
        .calc-option:hover label:before {
            border-color: #1e3c72;
            box-shadow: 0 2px 8px rgba(42, 82, 152, 0.3);
        }
        
        /* Focus state */
        .calc-option input[type="checkbox"]:focus + label:before {
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.3);
        }
        
        /* Disabled state */
        .calc-option input[type="checkbox"]:disabled + label:before {
            background: #e0e0e0;
            border-color: #999;
        }
        
        /* Fuel section */
        .fuel-cost-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border: 2px dashed #2a5298;
            margin-bottom: 16px;
            display: none;
        }
        
        .fuel-cost-group.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .unit-container {
            position: relative;
        }
        
        .unit-text {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 0.9rem;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 6px;
            pointer-events: none;
        }
        
        .fuel-price-info {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-top: 12px;
            font-size: 0.85rem;
        }
        
        .fuel-price-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .fuel-price-item:last-child {
            border-bottom: none;
        }
        
        /* Buttons */
        .buttons-row {
            display: flex;
            gap: 10px;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1 1 auto;
            min-width: 120px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            transform: scale(0.97);
        }
        
        .btn-primary {
            background: #2a5298;
            color: white;
            box-shadow: 0 4px 10px rgba(42, 82, 152, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        /* Stops list */
        .stops-section {
            margin-top: 8px;
        }
        
        .stops-list {
            max-height: 200px;
            overflow-y: auto;
            border: 2px dashed #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            background-color: #f9f9f9;
            margin-bottom: 10px;
            -webkit-overflow-scrolling: touch;
        }
        
        .stop-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.2s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .stop-details {
            flex: 1;
        }
        
        .stop-name {
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .stop-time {
            color: #666;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .stop-actions {
            display: flex;
            gap: 6px;
        }
        
        .stop-actions .btn {
            padding: 8px 12px;
            min-width: unset;
            font-size: 0.8rem;
        }
        
        .empty-message {
            text-align: center;
            color: #888;
            padding: 24px;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        /* Results Section */
        .results-section {
            padding: 0;
        }
        
        .results-controls {
            margin-bottom: 20px;
        }
        
        .results-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            max-height: calc(100vh - 250px);
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #555;
            font-size: 1.05rem;
        }
        
        .result-value {
            font-weight: 700;
            color: #1e3c72;
            font-size: 1.2rem;
        }
        
        .time-display {
            font-size: 1.2rem;
        }
        
        .total-time {
            background-color: #e8f4ff;
            padding: 14px;
            border-radius: 10px;
            margin-top: 10px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 700;
            color: #1e3c72;
        }
        
        .total-time-value {
            font-size: 1.9rem;
            margin-left: 10px;
        }
        
        .arrival-time-section {
            background-color: #e8f4ff;
            padding: 16px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            border: 2px solid #2a5298;
        }
        
        .arrival-label {
            font-size: 1rem;
            color: #555;
            margin-bottom: 8px;
        }
        
        .arrival-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e3c72;
        }
        
        .fuel-cost-section {
            background-color: #f0f8f0;
            padding: 16px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            border: 2px solid #28a745;
        }
        
        .fuel-cost-label {
            font-size: 1rem;
            color: #555;
            margin-bottom: 8px;
        }
        
        .fuel-cost-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #28a745;
        }
        
        .fuel-details {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
            text-align: center;
        }
        
        /* Tablet styles */
        @media (min-width: 768px) {
            .container {
                max-width: 1400px;
                margin: 20px auto;
                min-height: calc(100vh - 40px);
                border-radius: 20px;
            }
            
            header {
                border-radius: 20px 20px 0 0;
            }
            
            .mobile-tabs {
                display: none;
            }
            
            .panel {
                display: block !important;
            }
            
            .app-content {
                display: flex;
                flex-direction: row;
                height: calc(100vh - 140px);
                overflow: hidden;
            }
            
            .panel.input-panel {
                flex: 1;
                max-width: 450px;
                border-right: 1px solid #e0e0e0;
                overflow-y: auto;
            }
            
            .panel.stops-panel {
                display: none;
            }
            
            .panel.results-panel {
                flex: 2;
                overflow-y: auto;
            }
            
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
        }
        
        /* Mobile adjustments */
        @media (max-width: 767px) {
            .results-display {
                max-height: none;
                padding: 16px;
            }
            
            .total-time {
                font-size: 1.2rem;
            }
            
            .total-time-value {
                font-size: 1.6rem;
            }
            
            .arrival-value, .fuel-cost-value {
                font-size: 1.6rem;
            }
            
            .result-label {
                font-size: 0.95rem;
            }
            
            .result-value {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-route"></i>LOGi Trip</h1>
        </header>
        
        <!-- Mobile Tab Navigation -->
        <div class="mobile-tabs">
            <button class="tab-btn active" data-tab="input">
                <i class="fas fa-pencil-alt"></i>
                กรอกข้อมูล
            </button>
            <button class="tab-btn" data-tab="stops">
                <i class="fas fa-map-pin"></i>
                จุดแวะพัก
            </button>
            <button class="tab-btn" data-tab="results">
                <i class="fas fa-chart-bar"></i>
                ผลลัพธ์
            </button>
        </div>
        
        <div class="app-content">
            <!-- Input Panel -->
            <div class="panel input-panel active" id="inputPanel">
                <!-- ข้อมูลการเดินทาง -->
                <section class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-map-marker-alt"></i> 
                        ข้อมูลการเดินทาง
                    </h2>
                    
                    <div class="form-group">
                        <label for="startPoint"><i class="fas fa-play-circle"></i> จุดเริ่มต้น</label>
                        <input type="text" id="startPoint" placeholder="กรอกจุดเริ่มต้น" value="A">
                    </div>
                    
                    <div class="form-group">
                        <label for="endPoint"><i class="fas fa-flag-checkered"></i> จุดหมายปลายทาง</label>
                        <input type="text" id="endPoint" placeholder="กรอกจุดหมายปลายทาง" value="B">
                    </div>
                    
                    <div class="form-group">
                        <label for="departureTime"><i class="fas fa-clock"></i> เวลาออกเดินทาง</label>
                        <div class="departure-time-container">
                            <div class="departure-time-group" data-label="ชม">
                                <input type="number" id="departureHour" placeholder="0" min="0" max="23">
                            </div>
                            <div class="time-separator">:</div>
                            <div class="departure-time-group" data-label="นาที">
                                <input type="number" id="departureMinute" placeholder="0" min="0" max="59">
                            </div>
                        </div>
                        <div class="hint-text">รูปแบบ 24 ชั่วโมง</div>
                    </div>
                    
                    <!-- ตัวเลือกการคำนวณค่าน้ำมัน - ปรับปรุงใหม่ -->
                    <div class="calc-option">
                        <input type="checkbox" id="useFuelCalc">
                        <label for="useFuelCalc">
                            <i class="fas fa-gas-pump"></i> คำนวณค่าน้ำมัน
                        </label>
                    </div>
                    
                    <!-- ส่วนกรอกข้อมูลสำหรับคำนวณค่าน้ำมัน -->
                    <div id="fuelCostGroup" class="fuel-cost-group">
                        <div class="form-group">
                            <label for="distance"><i class="fas fa-road"></i> ระยะทาง</label>
                            <div class="unit-container">
                                <input type="number" id="distance" placeholder="0" min="0" step="0.1">
                                <span class="unit-text">กม.</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="fuelConsumption"><i class="fas fa-oil-can"></i> อัตราสิ้นเปลืองน้ำมัน</label>
                            <div class="unit-container">
                                <input type="number" id="fuelConsumption" placeholder="0" min="0" step="0.1">
                                <span class="unit-text">กม./ลิตร</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="fuelType"><i class="fas fa-gas-pump"></i> ประเภทน้ำมัน</label>
                            <select id="fuelType">
                                <option value="95">เบนซิน 95</option>
                                <option value="91">เบนซิน 91</option>
                                <option value="diesel">ดีเซล</option>
                                <option value="e20">แก๊สโซฮอล์ E20</option>
                                <option value="e85">แก๊สโซฮอล์ E85</option>
                            </select>
                        </div>
                        
                        <!-- แสดงราคาน้ำมัน -->
                        <div class="fuel-price-info">
                            <div class="fuel-price-item">
                                <span>เบนซิน 95:</span>
                                <span id="price95">กำลังโหลด...</span>
                            </div>
                            <div class="fuel-price-item">
                                <span>เบนซิน 91:</span>
                                <span id="price91">กำลังโหลด...</span>
                            </div>
                            <div class="fuel-price-item">
                                <span>ดีเซล:</span>
                                <span id="priceDiesel">กำลังโหลด...</span>
                            </div>
                            <div class="hint-text">ข้อมูลราคาน้ำมันอัปเดตล่าสุด</div>
                        </div>
                    </div>
                    
                    <!-- ส่วนกรอกเวลาเดินทาง -->
                    <div class="form-group">
                        <label for="travelTime"><i class="fas fa-hourglass-half"></i> ระยะเวลาเดินทาง</label>
                        <div class="time-input-container">
                            <div class="time-input-group" data-label="ชม">
                                <input type="number" id="travelHours" placeholder="0" min="0" max="99">
                            </div>
                            <div class="time-separator">:</div>
                            <div class="time-input-group" data-label="นาที">
                                <input type="number" id="travelMinutes" placeholder="0" min="0" max="59">
                            </div>
                        </div>
                        <div class="hint-text">เวลาที่ใช้ในการเดินทาง (ไม่รวมจุดแวะพัก)</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="transport"><i class="fas fa-car"></i> วิธีการเดินทาง</label>
                        <select id="transport">
                            <option value="car">รถยนต์</option>
                            <option value="motorcycle">รถจักรยานยนต์</option>
                            <option value="public">ขนส่งสาธารณะ</option>
                            <option value="walk">เดิน</option>
                            <option value="bike">จักรยาน</option>
                        </select>
                    </div>
                </section>
                
                <!-- ปุ่มดำเนินการ -->
                <div class="buttons-row">
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo-alt"></i> รีเซ็ต
                    </button>
                    <button class="btn btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i> คำนวณ
                    </button>
                </div>
            </div>
            
            <!-- Stops Panel -->
            <div class="panel" id="stopsPanel">
                <section class="stops-section">
                    <h2 class="section-title"><i class="fas fa-map-pin"></i> จุดแวะพัก</h2>
                    
                    <div class="form-group">
                        <label for="stopName"><i class="fas fa-store"></i> ชื่อจุดแวะพัก</label>
                        <input type="text" id="stopName" placeholder="เช่น ร้านกาแฟ, ปั๊มน้ำมัน">
                    </div>
                    
                    <div class="form-group">
                        <label for="stopTime"><i class="fas fa-hourglass-half"></i> เวลาแวะพัก (นาที)</label>
                        <input type="number" id="stopTime" placeholder="0" min="1">
                    </div>
                    
                    <div class="buttons-row">
                        <button class="btn btn-success" id="addStopBtn">
                            <i class="fas fa-plus-circle"></i> เพิ่มจุดแวะพัก
                        </button>
                        <button class="btn btn-secondary" id="clearStopsBtn">
                            <i class="fas fa-trash-alt"></i> ล้างทั้งหมด
                        </button>
                    </div>
                    
                    <div class="stops-list" id="stopsList">
                        <div class="empty-message" id="emptyStopsMessage">
                            <i class="fas fa-info-circle"></i> ยังไม่มีจุดแวะพัก
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Results Panel -->
            <div class="panel results-panel" id="resultsPanel">
                <section class="results-section">
                    <div class="results-controls">
                        <h2 class="section-title"><i class="fas fa-calculator"></i> ผลการคำนวณเวลาเดินทาง</h2>
                        <div class="buttons-row">
                            <button class="btn btn-secondary" id="copyResultsBtn">
                                <i class="fas fa-copy"></i> คัดลอกผลลัพธ์
                            </button>
                        </div>
                    </div>
                    
                    <div class="results-display" id="resultsDisplay">
                        <div class="result-item">
                            <span class="result-label">จุดเริ่มต้น:</span>
                            <span class="result-value" id="resultStart">A</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">จุดหมายปลายทาง:</span>
                            <span class="result-value" id="resultEnd">B</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">วิธีการเดินทาง:</span>
                            <span class="result-value" id="resultTransport">รถยนต์</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาออกเดินทาง:</span>
                            <span class="result-value time-display" id="resultDepartureTime"> </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาเดินทางพื้นฐาน:</span>
                            <span class="result-value time-display" id="resultBaseTime"> </span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">จำนวนจุดแวะพัก:</span>
                            <span class="result-value" id="resultStopsCount">0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาพักทั้งหมด:</span>
                            <span class="result-value time-display" id="resultTotalStopTime"> </span>
                        </div>
                        
                        <div class="total-time">
                            <span>เวลาเดินทางทั้งหมด: </span>
                            <span class="total-time-value" id="resultTotalTime"> </span>
                        </div>
                        
                        <div class="arrival-time-section" id="arrivalSection">
                            <div class="arrival-label">เวลาถึงโดยประมาณ:</div>
                            <div class="arrival-value" id="resultArrivalTime"> </div>
                        </div>
                        
                        <!-- ส่วนแสดงผลค่าน้ำมัน -->
                        <div id="fuelCostResult" class="fuel-cost-section" style="display: none;">
                            <div class="fuel-cost-label">ค่าน้ำมันโดยประมาณ</div>
                            <div class="fuel-cost-value" id="resultFuelCost">0 บาท</div>
                            <div class="fuel-details" id="fuelDetails"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // State management
        let stops = [];
        
        // DOM Elements
        const elements = {
            startPoint: document.getElementById('startPoint'),
            endPoint: document.getElementById('endPoint'),
            departureHour: document.getElementById('departureHour'),
            departureMinute: document.getElementById('departureMinute'),
            travelHours: document.getElementById('travelHours'),
            travelMinutes: document.getElementById('travelMinutes'),
            transport: document.getElementById('transport'),
            stopName: document.getElementById('stopName'),
            stopTime: document.getElementById('stopTime'),
            useFuelCalc: document.getElementById('useFuelCalc'),
            fuelCostGroup: document.getElementById('fuelCostGroup'),
            distance: document.getElementById('distance'),
            fuelConsumption: document.getElementById('fuelConsumption'),
            fuelType: document.getElementById('fuelType'),
            stopsList: document.getElementById('stopsList'),
            emptyStopsMessage: document.getElementById('emptyStopsMessage'),
            arrivalSection: document.getElementById('arrivalSection')
        };
        
        // Result elements
        const results = {
            start: document.getElementById('resultStart'),
            end: document.getElementById('resultEnd'),
            transport: document.getElementById('resultTransport'),
            departureTime: document.getElementById('resultDepartureTime'),
            baseTime: document.getElementById('resultBaseTime'),
            stopsCount: document.getElementById('resultStopsCount'),
            totalStopTime: document.getElementById('resultTotalStopTime'),
            totalTime: document.getElementById('resultTotalTime'),
            arrivalTime: document.getElementById('resultArrivalTime'),
            fuelCost: document.getElementById('resultFuelCost'),
            fuelDetails: document.getElementById('fuelDetails'),
            fuelCostResult: document.getElementById('fuelCostResult')
        };
        
        // Fuel prices
        let fuelPrices = {
            '95': 30.55,   
            '91': 30.18,   
            'diesel': 30.44, 
            'e20': 28.34,  
            'e85': 26.29  
        };
        
        // Mobile tab handling
        const tabs = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.panel');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetPanel = tab.dataset.tab;
                
                tabs.forEach(t => t.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(targetPanel + 'Panel').classList.add('active');
                
                if (targetPanel === 'results') {
                    calculateTotalTime();
                }
            });
        });
        
        // Utility functions
        function formatTimeNumber(num) {
            return num < 10 ? `0${num}` : `${num}`;
        }
        
        function minutesToHoursMinutes(totalMinutes) {
            if (!totalMinutes && totalMinutes !== 0) return '0 min';
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            if (hours === 0) {
                return `${minutes} min`;
            } else if (minutes === 0) {
                return `${hours} hr`;
            } else {
                return `${hours} hr ${minutes} min`;
            }
        }
        
        function timeToMinutes(hours, minutes) {
            return (parseInt(hours) || 0) * 60 + (parseInt(minutes) || 0);
        }
        
        function validateTimeInput(hoursInput, minutesInput, maxHour = 99) {
            let hours = parseInt(hoursInput.value) || 0;
            let minutes = parseInt(minutesInput.value) || 0;
            
            if (minutes >= 60) {
                hours += Math.floor(minutes / 60);
                minutes = minutes % 60;
                minutesInput.value = minutes;
            }
            
            if (hours > maxHour) {
                hours = maxHour;
                hoursInput.value = hours;
            }
            
            hours = Math.max(0, hours);
            minutes = Math.max(0, minutes);
            
            hoursInput.value = hours || '';
            minutesInput.value = minutes || '';
            
            return { hours, minutes };
        }
        
        function calculateArrivalTime(departureHour, departureMinute, totalTravelMinutes) {
            let departureTotalMinutes = (parseInt(departureHour) || 0) * 60 + (parseInt(departureMinute) || 0);
            let arrivalTotalMinutes = departureTotalMinutes + (parseInt(totalTravelMinutes) || 0);
            
            let arrivalHour = Math.floor(arrivalTotalMinutes / 60) % 24;
            let arrivalMinute = arrivalTotalMinutes % 60;
            let nextDay = Math.floor(arrivalTotalMinutes / (24 * 60));
            let dayText = nextDay > 0 ? ` (+${nextDay} วัน)` : '';
            
            return {
                hour: arrivalHour,
                minute: arrivalMinute,
                formattedTime: `${formatTimeNumber(arrivalHour)}:${formatTimeNumber(arrivalMinute)}${dayText}`,
                nextDay: nextDay
            };
        }
        
        function calculateFuelCost() {
            const distance = parseFloat(elements.distance.value) || 0;
            const consumption = parseFloat(elements.fuelConsumption.value) || 0;
            const fuelType = elements.fuelType.value;
            
            if (distance <= 0 || consumption <= 0) return null;
            
            const price = fuelPrices[fuelType] || fuelPrices['95'];
            const fuelUsed = distance / consumption;
            const cost = fuelUsed * price;
            
            return {
                cost: cost,
                fuelUsed: fuelUsed,
                price: price,
                detail: `ระยะทาง ${distance} กม. ÷ อัตราสิ้นเปลือง ${consumption} กม./ลิตร = ใช้ ${fuelUsed.toFixed(2)} ลิตร × ราคา ${price.toFixed(2)} บาท/ลิตร`
            };
        }
        
        // Main calculation
        function calculateTotalTime() {
            const startPoint = elements.startPoint.value.trim() || '-';
            const endPoint = elements.endPoint.value.trim() || '-';
            const transport = elements.transport.options[elements.transport.selectedIndex].text;
            
            const departureTime = validateTimeInput(elements.departureHour, elements.departureMinute, 23);
            const departureHour = departureTime.hours;
            const departureMinute = departureTime.minutes;
            
            const formattedDepartureTime = departureHour === 0 && departureMinute === 0 ? 
                '' : `${formatTimeNumber(departureHour)}:${formatTimeNumber(departureMinute)}`;
            results.departureTime.textContent = formattedDepartureTime || '-';
            
            const travelTime = validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
            const travelMinutes = timeToMinutes(travelTime.hours, travelTime.minutes);
            
            const totalStopTime = stops.reduce((sum, stop) => sum + stop.time, 0);
            const totalTimeMinutes = travelMinutes + totalStopTime;
            
            let arrivalTimeText = '-';
            
            if ((departureHour !== 0 || departureMinute !== 0) && totalTimeMinutes > 0) {
                const arrivalTime = calculateArrivalTime(departureHour, departureMinute, totalTimeMinutes);
                arrivalTimeText = arrivalTime.formattedTime;
                elements.arrivalSection.style.display = 'block';
            } else {
                elements.arrivalSection.style.display = 'none';
            }
            
            if (elements.useFuelCalc.checked) {
                const fuelResult = calculateFuelCost();
                if (fuelResult) {
                    results.fuelCost.textContent = `${fuelResult.cost.toFixed(2)} บาท`;
                    results.fuelDetails.textContent = fuelResult.detail;
                    results.fuelCostResult.style.display = 'block';
                } else {
                    results.fuelCostResult.style.display = 'none';
                }
            } else {
                results.fuelCostResult.style.display = 'none';
            }
            
            results.start.textContent = startPoint;
            results.end.textContent = endPoint;
            results.transport.textContent = transport;
            results.baseTime.textContent = minutesToHoursMinutes(travelMinutes);
            results.stopsCount.textContent = stops.length;
            results.totalStopTime.textContent = minutesToHoursMinutes(totalStopTime);
            results.totalTime.textContent = minutesToHoursMinutes(totalTimeMinutes);
            results.arrivalTime.textContent = arrivalTimeText;
        }
        
        // Stop management functions
        function addStop() {
            const stopName = elements.stopName.value.trim();
            const stopTime = parseInt(elements.stopTime.value) || 0;
            
            if (!stopName) {
                alert('กรุณากรอกชื่อจุดแวะพัก');
                elements.stopName.focus();
                return;
            }
            
            if (stopTime <= 0) {
                alert('กรุณากรอกเวลาแวะพักที่ถูกต้อง (มากกว่า 0 นาที)');
                elements.stopTime.focus();
                return;
            }
            
            stops.push({
                id: Date.now(),
                name: stopName,
                time: stopTime
            });
            
            elements.stopName.value = '';
            elements.stopTime.value = '';
            
            updateStopsList();
            calculateTotalTime();
        }
        
        function updateStopsList() {
            elements.stopsList.innerHTML = '';
            
            if (stops.length === 0) {
                elements.stopsList.appendChild(elements.emptyStopsMessage);
                return;
            }
            
            stops.forEach(stop => {
                const stopElement = document.createElement('div');
                stopElement.className = 'stop-item';
                stopElement.innerHTML = `
                    <div class="stop-details">
                        <div class="stop-name">${stop.name}</div>
                        <div class="stop-time">เวลาแวะพัก: ${stop.time} นาที</div>
                    </div>
                    <div class="stop-actions">
                        <button class="btn btn-secondary edit-stop-btn" data-id="${stop.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-stop-btn" data-id="${stop.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                elements.stopsList.appendChild(stopElement);
            });
            
            document.querySelectorAll('.edit-stop-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const stopId = parseInt(this.dataset.id);
                    editStop(stopId);
                });
            });
            
            document.querySelectorAll('.delete-stop-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    const stopId = parseInt(this.dataset.id);
                    deleteStop(stopId);
                });
            });
        }
        
        function editStop(stopId) {
            const stop = stops.find(s => s.id === stopId);
            if (!stop) return;
            
            elements.stopName.value = stop.name;
            elements.stopTime.value = stop.time;
            
            stops = stops.filter(s => s.id !== stopId);
            updateStopsList();
            calculateTotalTime();
            
            document.querySelector('[data-tab="stops"]').click();
            elements.stopName.focus();
        }
        
        function deleteStop(stopId) {
            if (confirm('คุณต้องการลบจุดแวะพักนี้ใช่หรือไม่?')) {
                stops = stops.filter(stop => stop.id !== stopId);
                updateStopsList();
                calculateTotalTime();
            }
        }
        
        function clearAllStops() {
            if (stops.length === 0) {
                alert('ไม่มีจุดแวะพักให้ลบ');
                return;
            }
            
            if (confirm('คุณต้องการลบจุดแวะพักทั้งหมดใช่หรือไม่?')) {
                stops = [];
                updateStopsList();
                calculateTotalTime();
            }
        }
        
        function resetAll() {
            if (confirm('คุณต้องการรีเซ็ตข้อมูลทั้งหมดใช่หรือไม่?')) {
                elements.startPoint.value = 'A';
                elements.endPoint.value = 'B';
                elements.departureHour.value = '';
                elements.departureMinute.value = '';
                elements.travelHours.value = '';
                elements.travelMinutes.value = '';
                elements.distance.value = '';
                elements.fuelConsumption.value = '';
                elements.fuelType.value = '95';
                elements.useFuelCalc.checked = false;
                elements.fuelCostGroup.classList.remove('show');
                elements.transport.value = 'car';
                elements.stopName.value = '';
                elements.stopTime.value = '';
                
                stops = [];
                updateStopsList();
                calculateTotalTime();
                
                document.querySelector('[data-tab="input"]').click();
            }
        }
        
        async function copyResults() {
            try {
                const resultsData = {
                    startPoint: document.getElementById('resultStart').textContent,
                    endPoint: document.getElementById('resultEnd').textContent,
                    transport: document.getElementById('resultTransport').textContent,
                    departureTime: document.getElementById('resultDepartureTime').textContent,
                    baseTime: document.getElementById('resultBaseTime').textContent,
                    stopsCount: document.getElementById('resultStopsCount').textContent,
                    totalStopTime: document.getElementById('resultTotalStopTime').textContent,
                    totalTime: document.getElementById('resultTotalTime').textContent,
                    arrivalTime: document.getElementById('resultArrivalTime').textContent,
                    fuelCost: document.getElementById('useFuelCalc').checked ? document.getElementById('resultFuelCost').textContent : null
                };
                
                let formattedText = `LogiTrip - ผลการคำนวณเวลาเดินทาง\n`;
                formattedText += `========================\n`;
                formattedText += `จุดเริ่มต้น: ${resultsData.startPoint}\n`;
                formattedText += `จุดหมายปลายทาง: ${resultsData.endPoint}\n`;
                formattedText += `วิธีการเดินทาง: ${resultsData.transport}\n`;
                
                if (resultsData.departureTime && resultsData.departureTime !== '-') {
                    formattedText += `เวลาออกเดินทาง: ${resultsData.departureTime}\n`;
                }
                
                formattedText += `เวลาเดินทางพื้นฐาน: ${resultsData.baseTime}\n`;
                formattedText += `จำนวนจุดแวะพัก: ${resultsData.stopsCount}\n`;
                formattedText += `เวลาพักทั้งหมด: ${resultsData.totalStopTime}\n`;
                formattedText += `เวลาเดินทางทั้งหมด: ${resultsData.totalTime}\n`;
                formattedText += `========================\n`;
                
                if (resultsData.arrivalTime && resultsData.arrivalTime !== '-') {
                    formattedText += `เวลาถึงโดยประมาณ: ${resultsData.arrivalTime}\n`;
                }
                
                if (resultsData.fuelCost) {
                    formattedText += `ค่าน้ำมันโดยประมาณ: ${resultsData.fuelCost}\n`;
                }
                
                formattedText += `\nอัปเดตเมื่อ: ${new Date().toLocaleString('th-TH')}`;
                
                await navigator.clipboard.writeText(formattedText);
                alert('คัดลอกผลลัพธ์เรียบร้อยแล้ว!');
                
            } catch (error) {
                alert('ไม่สามารถคัดลอกผลลัพธ์ได้');
            }
        }
        
        // Fetch fuel prices
        async function fetchFuelPrices() {
            try {
                const mockPrices = {
                    '95': 30.55,   
                    '91': 30.18,   
                    'diesel': 30.44, 
                    'e20': 28.34,  
                    'e85': 26.29  
                };
                
                fuelPrices = mockPrices;
                
                document.getElementById('price95').textContent = `${mockPrices['95'].toFixed(2)} บาท`;
                document.getElementById('price91').textContent = `${mockPrices['91'].toFixed(2)} บาท`;
                document.getElementById('priceDiesel').textContent = `${mockPrices['diesel'].toFixed(2)} บาท`;
                
            } catch (error) {
                console.log('Using default prices');
                document.getElementById('price95').textContent = `${fuelPrices['95'].toFixed(2)} บาท`;
                document.getElementById('price91').textContent = `${fuelPrices['91'].toFixed(2)} บาท`;
                document.getElementById('priceDiesel').textContent = `${fuelPrices['diesel'].toFixed(2)} บาท`;
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            elements.startPoint.addEventListener('input', calculateTotalTime);
            elements.endPoint.addEventListener('input', calculateTotalTime);
            elements.transport.addEventListener('change', calculateTotalTime);
            elements.fuelType.addEventListener('change', calculateTotalTime);
            
            elements.departureHour.addEventListener('input', () => {
                validateTimeInput(elements.departureHour, elements.departureMinute, 23);
                calculateTotalTime();
            });
            
            elements.departureMinute.addEventListener('input', () => {
                validateTimeInput(elements.departureHour, elements.departureMinute, 23);
                calculateTotalTime();
            });
            
            elements.travelHours.addEventListener('input', () => {
                validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
                calculateTotalTime();
            });
            
            elements.travelMinutes.addEventListener('input', () => {
                validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
                calculateTotalTime();
            });
            
            // Fuel calculation checkbox - ใช้ event นี้
            elements.useFuelCalc.addEventListener('change', function(e) {
                if (this.checked) {
                    elements.fuelCostGroup.classList.add('show');
                } else {
                    elements.fuelCostGroup.classList.remove('show');
                    results.fuelCostResult.style.display = 'none';
                }
                calculateTotalTime();
            });
            
            elements.distance.addEventListener('input', calculateTotalTime);
            elements.fuelConsumption.addEventListener('input', calculateTotalTime);
            
            document.getElementById('addStopBtn').addEventListener('click', addStop);
            document.getElementById('clearStopsBtn').addEventListener('click', clearAllStops);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
            
            document.getElementById('calculateBtn').addEventListener('click', () => {
                calculateTotalTime();
                document.querySelector('[data-tab="results"]').click();
            });
            
            document.getElementById('copyResultsBtn').addEventListener('click', copyResults);
            
            elements.stopName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addStop();
                }
            });
            
            elements.stopTime.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    addStop();
                }
            });
        }
        
        // Initialize
        function init() {
            setupEventListeners();
            fetchFuelPrices();
            setInterval(fetchFuelPrices, 5 * 60 * 1000);
            updateStopsList();
            calculateTotalTime();
        }
        
        init();
    </script>
</body>
</html>
