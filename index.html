<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>LogiTrip - วางแผนการเดินทาง</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Prompt', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        body {
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        /* Mobile-first design */
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0, 0, 100, 0.1);
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 16px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header h1 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        header h1 i {
            font-size: 1.3rem;
        }
        
        header p {
            font-size: 0.8rem;
            opacity: 0.9;
            margin-top: 4px;
        }
        
        .app-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        /* Tab navigation สำหรับมือถือ */
        .mobile-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 70px;
            z-index: 9;
            background: #f8faff;
        }
        
        .tab-btn {
            flex: 1;
            padding: 14px 8px;
            border: none;
            background: none;
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .tab-btn i {
            font-size: 1rem;
        }
        
        .tab-btn.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
            background: white;
        }
        
        .tab-btn:active {
            background: #e8f0fe;
        }
        
        /* Panel styles */
        .panel {
            display: none;
            padding: 16px;
            background: white;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .panel.active {
            display: block;
        }
        
        /* Form styles สำหรับมือถือ */
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            color: #2a5298;
            font-size: 1.1rem;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f4ff;
        }
        
        .section-title i {
            margin-right: 8px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        .form-section {
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        label i {
            color: #2a5298;
            width: 18px;
            font-size: 0.9rem;
        }
        
        input, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }
        
        input:focus, select:focus {
            border-color: #2a5298;
            outline: none;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }
        
        /* Custom select */
        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        /* Time input containers */
        .time-input-container, .departure-time-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 8px;
            align-items: center;
        }
        
        .time-input-group, .departure-time-group {
            position: relative;
            flex: 1;
        }
        
        .time-input-group input, .departure-time-group input {
            padding-left: 45px;
            text-align: center;
        }
        
        .time-input-group:after, .departure-time-group:after {
            content: attr(data-label);
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 600;
            font-size: 0.85rem;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            pointer-events: none;
        }
        
        .time-separator {
            font-size: 1.3rem;
            font-weight: bold;
            color: #2a5298;
        }
        
        .hint-text {
            font-size: 0.75rem;
            color: #888;
            margin-top: 6px;
            padding-left: 4px;
        }
        
        /* Checkbox style */
        .calc-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calc-option:active {
            background: #e8f0fe;
        }
        
        .calc-option input[type="checkbox"] {
            width: 22px;
            height: 22px;
            margin-right: 12px;
            accent-color: #2a5298;
        }
        
        .calc-option label {
            margin-bottom: 0;
            font-weight: 600;
            color: #2a5298;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Fuel cost section */
        .fuel-cost-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            border: 2px dashed #2a5298;
            margin-bottom: 16px;
            display: none;
        }
        
        .fuel-cost-group.show {
            display: block;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .unit-container {
            position: relative;
        }
        
        .unit-text {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 0.9rem;
            background: #f0f0f0;
            padding: 4px 8px;
            border-radius: 6px;
            pointer-events: none;
        }
        
        .fuel-price-info {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-top: 12px;
            font-size: 0.85rem;
        }
        
        .fuel-price-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .fuel-price-item:last-child {
            border-bottom: none;
        }
        
        /* Button styles สำหรับมือถือ */
        .buttons-row {
            display: flex;
            gap: 10px;
            margin: 16px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1 1 auto;
            min-width: 120px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn:active {
            transform: scale(0.97);
        }
        
        .btn-primary {
            background: #2a5298;
            color: white;
            box-shadow: 0 4px 10px rgba(42, 82, 152, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn i {
            font-size: 1rem;
        }
        
        /* Stops list */
        .stops-section {
            margin-top: 8px;
        }
        
        .stops-list {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            background: #f8f9fa;
            padding: 12px;
            margin-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .stop-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.2s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .stop-details {
            flex: 1;
        }
        
        .stop-name {
            font-weight: 600;
            color: #1e3c72;
            margin-bottom: 4px;
            font-size: 0.95rem;
        }
        
        .stop-time {
            color: #666;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .stop-actions {
            display: flex;
            gap: 6px;
        }
        
        .stop-actions .btn {
            padding: 8px 12px;
            min-width: unset;
            font-size: 0.8rem;
        }
        
        .empty-message {
            text-align: center;
            color: #888;
            padding: 24px;
            font-style: italic;
            font-size: 0.9rem;
        }
        
        /* Results panel */
        .results-display {
            background: white;
            padding: 16px;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin-top: 8px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }
        
        .result-value {
            font-weight: 700;
            color: #1e3c72;
            font-size: 1rem;
        }
        
        .total-time {
            background: #e8f4ff;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            font-weight: 600;
            color: #1e3c72;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .total-time-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2a5298;
        }
        
        .arrival-time-section, .fuel-cost-section {
            padding: 16px;
            border-radius: 12px;
            margin: 12px 0;
            text-align: center;
        }
        
        .arrival-time-section {
            background: #e8f4ff;
            border: 2px solid #2a5298;
        }
        
        .fuel-cost-section {
            background: #e8f8e8;
            border: 2px solid #28a745;
        }
        
        .arrival-label, .fuel-cost-label {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 6px;
        }
        
        .arrival-value, .fuel-cost-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .arrival-value {
            color: #1e3c72;
        }
        
        .fuel-cost-value {
            color: #28a745;
        }
        
        /* Scrollbar สำหรับมือถือ */
        .panel::-webkit-scrollbar, .stops-list::-webkit-scrollbar {
            width: 4px;
        }
        
        .panel::-webkit-scrollbar-thumb, .stops-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }
        
        /* Floating action button สำหรับเพิ่มจุดแวะพัก */
        .fab-container {
            display: none;
        }
        
        /* Quick actions */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin: 12px 0;
        }
        
        .quick-actions .btn {
            flex: 1;
            padding: 12px;
        }
        
        /* Responsive สำหรับแท็บเล็ต */
        @media (min-width: 768px) {
            .container {
                max-width: 1400px;
                margin: 20px auto;
                min-height: calc(100vh - 40px);
                border-radius: 20px;
            }
            
            header {
                border-radius: 20px 20px 0 0;
            }
            
            .mobile-tabs {
                display: none;
            }
            
            .panel {
                display: block !important;
            }
            
            .app-content {
                flex-direction: row;
                height: calc(100vh - 140px);
            }
            
            .panel.input-panel, .panel.results-panel {
                flex: 1;
                overflow-y: auto;
            }
            
            .input-panel {
                border-right: 1px solid #e0e0e0;
                max-width: 450px;
            }
            
            .results-panel {
                flex: 2;
            }
            
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            .btn:hover {
                transform: translateY(-2px);
            }
            
            .btn:active {
                transform: scale(0.98);
            }
        }
        
        /* ปรับปรุงการแตะบนมือถือ */
        @media (max-width: 767px) {
            input, select, .btn {
                font-size: 16px; /* ป้องกันการซูมอัตโนมัติ */
            }
            
            .stop-actions .btn {
                padding: 10px 14px;
            }
            
            .btn {
                padding: 16px;
            }
            
            .total-time-value {
                font-size: 1.6rem;
            }
            
            .arrival-value, .fuel-cost-value {
                font-size: 1.6rem;
            }
        }
        
        /* จัดการกับจอเล็กมาก */
        @media (max-width: 360px) {
            header h1 {
                font-size: 1.3rem;
            }
            
            .tab-btn {
                font-size: 0.8rem;
                padding: 12px 4px;
            }
            
            .btn {
                padding: 12px;
                font-size: 0.85rem;
            }
            
            .total-time-value {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <i class="fas fa-route"></i>
                LogiTrip
            </h1>
            <p>วางแผนการเดินทางของคุณ</p>
        </header>
        
        <!-- Mobile Tab Navigation -->
        <div class="mobile-tabs">
            <button class="tab-btn active" data-tab="input">
                <i class="fas fa-pencil-alt"></i>
                กรอกข้อมูล
            </button>
            <button class="tab-btn" data-tab="stops">
                <i class="fas fa-map-pin"></i>
                จุดแวะพัก
            </button>
            <button class="tab-btn" data-tab="results">
                <i class="fas fa-chart-bar"></i>
                ผลลัพธ์
            </button>
        </div>
        
        <div class="app-content">
            <!-- แผงกรอกข้อมูล -->
            <div class="panel input-panel active" id="inputPanel">
                <section class="form-section">
                    <h2 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        ข้อมูลการเดินทาง
                    </h2>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-play-circle"></i>
                            จุดเริ่มต้น
                        </label>
                        <input type="text" id="startPoint" placeholder="เช่น บ้าน, ที่ทำงาน" value="A">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-flag-checkered"></i>
                            จุดหมายปลายทาง
                        </label>
                        <input type="text" id="endPoint" placeholder="เช่น สนามบิน, ห้าง" value="B">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-clock"></i>
                            เวลาออกเดินทาง
                        </label>
                        <div class="departure-time-container">
                            <div class="departure-time-group" data-label="ชม.">
                                <input type="number" id="departureHour" placeholder="0" min="0" max="23" inputmode="numeric">
                            </div>
                            <span class="time-separator">:</span>
                            <div class="departure-time-group" data-label="นาที">
                                <input type="number" id="departureMinute" placeholder="0" min="0" max="59" inputmode="numeric">
                            </div>
                        </div>
                        <div class="hint-text">รูปแบบ 24 ชั่วโมง (ไม่ระบุ = ไม่คำนวณเวลาถึง)</div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-hourglass-half"></i>
                            ระยะเวลาเดินทาง
                        </label>
                        <div class="time-input-container">
                            <div class="time-input-group" data-label="ชม.">
                                <input type="number" id="travelHours" placeholder="0" min="0" inputmode="numeric">
                            </div>
                            <span class="time-separator">:</span>
                            <div class="time-input-group" data-label="นาที">
                                <input type="number" id="travelMinutes" placeholder="0" min="0" max="59" inputmode="numeric">
                            </div>
                        </div>
                        <div class="hint-text">เวลาที่ใช้เดินทาง (ไม่รวมจุดแวะพัก)</div>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-car"></i>
                            วิธีการเดินทาง
                        </label>
                        <select id="transport">
                            <option value="car">รถยนต์</option>
                            <option value="motorcycle">รถจักรยานยนต์</option>
                            <option value="public">ขนส่งสาธารณะ</option>
                            <option value="walk">เดิน</option>
                            <option value="bike">จักรยาน</option>
                        </select>
                    </div>
                    
                    <!-- ตัวเลือกคำนวณค่าน้ำมัน -->
                    <div class="calc-option" onclick="document.getElementById('useFuelCalc').click()">
                        <input type="checkbox" id="useFuelCalc">
                        <label for="useFuelCalc">
                            <i class="fas fa-gas-pump"></i>
                            คำนวณค่าน้ำมัน
                        </label>
                    </div>
                    
                    <!-- ส่วนกรอกข้อมูลน้ำมัน -->
                    <div id="fuelCostGroup" class="fuel-cost-group">
                        <div class="form-group">
                            <label>
                                <i class="fas fa-road"></i>
                                ระยะทาง
                            </label>
                            <div class="unit-container">
                                <input type="number" id="distance" placeholder="0" min="0" step="0.1" inputmode="decimal">
                                <span class="unit-text">กม.</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-oil-can"></i>
                                อัตราสิ้นเปลือง
                            </label>
                            <div class="unit-container">
                                <input type="number" id="fuelConsumption" placeholder="0" min="0" step="0.1" inputmode="decimal">
                                <span class="unit-text">กม./ลิตร</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <i class="fas fa-gas-pump"></i>
                                ประเภทน้ำมัน
                            </label>
                            <select id="fuelType">
                                <option value="95">เบนซิน 95</option>
                                <option value="91">เบนซิน 91</option>
                                <option value="diesel">ดีเซล</option>
                                <option value="e20">แก๊สโซฮอล์ E20</option>
                                <option value="e85">แก๊สโซฮอล์ E85</option>
                            </select>
                        </div>
                        
                        <div class="fuel-price-info">
                            <div class="fuel-price-item">
                                <span>เบนซิน 95:</span>
                                <span id="price95">กำลังโหลด...</span>
                            </div>
                            <div class="fuel-price-item">
                                <span>เบนซิน 91:</span>
                                <span id="price91">กำลังโหลด...</span>
                            </div>
                            <div class="fuel-price-item">
                                <span>ดีเซล:</span>
                                <span id="priceDiesel">กำลังโหลด...</span>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- ปุ่มดำเนินการ -->
                <div class="quick-actions">
                    <button class="btn btn-secondary" id="resetBtn">
                        <i class="fas fa-redo-alt"></i>
                        รีเซ็ต
                    </button>
                    <button class="btn btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i>
                        คำนวณ
                    </button>
                </div>
            </div>
            
            <!-- แผงจุดแวะพัก -->
            <div class="panel" id="stopsPanel">
                <section class="stops-section">
                    <h2 class="section-title">
                        <i class="fas fa-map-pin"></i>
                        จุดแวะพัก
                    </h2>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-store"></i>
                            ชื่อจุดแวะพัก
                        </label>
                        <input type="text" id="stopName" placeholder="เช่น ร้านกาแฟ, ปั๊มน้ำมัน">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <i class="fas fa-hourglass-half"></i>
                            เวลาที่แวะ (นาที)
                        </label>
                        <input type="number" id="stopTime" placeholder="0" min="1" inputmode="numeric">
                    </div>
                    
                    <div class="buttons-row">
                        <button class="btn btn-success" id="addStopBtn">
                            <i class="fas fa-plus-circle"></i>
                            เพิ่ม
                        </button>
                        <button class="btn btn-secondary" id="clearStopsBtn">
                            <i class="fas fa-trash-alt"></i>
                            ล้างทั้งหมด
                        </button>
                    </div>
                    
                    <div class="stops-list" id="stopsList">
                        <div class="empty-message" id="emptyStopsMessage">
                            <i class="fas fa-info-circle"></i> ยังไม่มีจุดแวะพัก<br>
                            <span style="font-size: 0.8rem;">เพิ่มจุดแวะพักด้านบน</span>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- แผงแสดงผลลัพธ์ -->
            <div class="panel results-panel" id="resultsPanel">
                <section class="results-section">
                    <h2 class="section-title">
                        <i class="fas fa-calculator"></i>
                        ผลการคำนวณ
                    </h2>
                    
                    <div class="results-display" id="resultsDisplay">
                        <div class="result-item">
                            <span class="result-label">จุดเริ่มต้น:</span>
                            <span class="result-value" id="resultStart">A</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">จุดหมาย:</span>
                            <span class="result-value" id="resultEnd">B</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">การเดินทาง:</span>
                            <span class="result-value" id="resultTransport">รถยนต์</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาออกเดินทาง:</span>
                            <span class="result-value" id="resultDepartureTime">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาเดินทาง:</span>
                            <span class="result-value" id="resultBaseTime">0 min</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">จุดแวะพัก:</span>
                            <span class="result-value" id="resultStopsCount">0</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">เวลาพักทั้งหมด:</span>
                            <span class="result-value" id="resultTotalStopTime">0 min</span>
                        </div>
                        
                        <div class="total-time">
                            <span>รวมเวลา:</span>
                            <span class="total-time-value" id="resultTotalTime">0 min</span>
                        </div>
                        
                        <div class="arrival-time-section" id="arrivalSection" style="display: none;">
                            <div class="arrival-label">
                                <i class="fas fa-clock"></i> เวลาถึงโดยประมาณ
                            </div>
                            <div class="arrival-value" id="resultArrivalTime">--:--</div>
                        </div>
                        
                        <div id="fuelCostResult" class="fuel-cost-section" style="display: none;">
                            <div class="fuel-cost-label">
                                <i class="fas fa-gas-pump"></i> ค่าน้ำมันโดยประมาณ
                            </div>
                            <div class="fuel-cost-value" id="resultFuelCost">0 บาท</div>
                            <div class="fuel-details" id="fuelDetails" style="font-size: 0.7rem; margin-top: 8px;"></div>
                        </div>
                        
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" id="copyResultsBtn" style="width: 100%;">
                                <i class="fas fa-copy"></i> คัดลอกผลลัพธ์
                            </button>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // State management
        let stops = [];
        
        // DOM Elements
        const elements = {
            startPoint: document.getElementById('startPoint'),
            endPoint: document.getElementById('endPoint'),
            departureHour: document.getElementById('departureHour'),
            departureMinute: document.getElementById('departureMinute'),
            travelHours: document.getElementById('travelHours'),
            travelMinutes: document.getElementById('travelMinutes'),
            transport: document.getElementById('transport'),
            stopName: document.getElementById('stopName'),
            stopTime: document.getElementById('stopTime'),
            useFuelCalc: document.getElementById('useFuelCalc'),
            fuelCostGroup: document.getElementById('fuelCostGroup'),
            distance: document.getElementById('distance'),
            fuelConsumption: document.getElementById('fuelConsumption'),
            fuelType: document.getElementById('fuelType'),
            stopsList: document.getElementById('stopsList'),
            emptyStopsMessage: document.getElementById('emptyStopsMessage'),
            arrivalSection: document.getElementById('arrivalSection')
        };
        
        // Result elements
        const results = {
            start: document.getElementById('resultStart'),
            end: document.getElementById('resultEnd'),
            transport: document.getElementById('resultTransport'),
            departureTime: document.getElementById('resultDepartureTime'),
            baseTime: document.getElementById('resultBaseTime'),
            stopsCount: document.getElementById('resultStopsCount'),
            totalStopTime: document.getElementById('resultTotalStopTime'),
            totalTime: document.getElementById('resultTotalTime'),
            arrivalTime: document.getElementById('resultArrivalTime'),
            fuelCost: document.getElementById('resultFuelCost'),
            fuelDetails: document.getElementById('fuelDetails'),
            fuelCostResult: document.getElementById('fuelCostResult')
        };
        
        // Fuel prices
        let fuelPrices = {
            '95': 35.94,
            '91': 34.76,
            'diesel': 33.94,
            'e20': 34.54,
            'e85': 30.29
        };
        
        // Mobile tab handling
        const tabs = document.querySelectorAll('.tab-btn');
        const panels = document.querySelectorAll('.panel');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetPanel = tab.dataset.tab;
                
                tabs.forEach(t => t.classList.remove('active'));
                panels.forEach(p => p.classList.remove('active'));
                
                tab.classList.add('active');
                
                if (targetPanel === 'input') {
                    document.getElementById('inputPanel').classList.add('active');
                } else if (targetPanel === 'stops') {
                    document.getElementById('stopsPanel').classList.add('active');
                } else if (targetPanel === 'results') {
                    document.getElementById('resultsPanel').classList.add('active');
                    calculateTotalTime(); // รีคำนวณเมื่อมาเห็นผลลัพธ์
                }
            });
        });
        
        // Utility functions
        function formatTimeNumber(num) {
            return num < 10 ? `0${num}` : `${num}`;
        }
        
        function minutesToHoursMinutes(totalMinutes) {
            if (totalMinutes === 0) return '0 min';
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            if (hours === 0) return `${minutes} min`;
            if (minutes === 0) return `${hours} hr`;
            return `${hours} hr ${minutes} min`;
        }
        
        function validateTimeInput(hoursInput, minutesInput, maxHour = 23) {
            let hours = parseInt(hoursInput.value) || 0;
            let minutes = parseInt(minutesInput.value) || 0;
            
            if (minutes >= 60) {
                hours += Math.floor(minutes / 60);
                minutes = minutes % 60;
                minutesInput.value = minutes;
            }
            
            if (hours > maxHour) {
                hours = maxHour;
                hoursInput.value = hours;
            }
            
            hours = Math.max(0, hours);
            minutes = Math.max(0, minutes);
            
            hoursInput.value = hours || '';
            minutesInput.value = minutes || '';
            
            return { hours, minutes };
        }
        
        function calculateArrivalTime(departureHour, departureMinute, totalMinutes) {
            const departureTotal = (departureHour || 0) * 60 + (departureMinute || 0);
            const arrivalTotal = departureTotal + totalMinutes;
            
            const hour = Math.floor(arrivalTotal / 60) % 24;
            const minute = arrivalTotal % 60;
            const day = Math.floor(arrivalTotal / (24 * 60));
            
            return {
                hour,
                minute,
                day,
                formatted: `${formatTimeNumber(hour)}:${formatTimeNumber(minute)}${day > 0 ? ` +${day}` : ''}`
            };
        }
        
        function calculateFuelCost() {
            const distance = parseFloat(elements.distance.value) || 0;
            const consumption = parseFloat(elements.fuelConsumption.value) || 0;
            const fuelType = elements.fuelType.value;
            
            if (distance <= 0 || consumption <= 0) return null;
            
            const price = fuelPrices[fuelType] || fuelPrices['95'];
            const fuelUsed = distance / consumption;
            const cost = fuelUsed * price;
            
            return {
                cost,
                fuelUsed,
                price,
                detail: `${distance.toFixed(1)} กม. ÷ ${consumption.toFixed(1)} กม./ลิตร = ${fuelUsed.toFixed(2)} ลิตร × ${price.toFixed(2)} บาท`
            };
        }
        
        // Main calculation
        function calculateTotalTime() {
            // Get values
            const startPoint = elements.startPoint.value.trim() || '-';
            const endPoint = elements.endPoint.value.trim() || '-';
            const transport = elements.transport.options[elements.transport.selectedIndex].text;
            
            // Validate time inputs
            const departure = validateTimeInput(elements.departureHour, elements.departureMinute, 23);
            const travel = validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
            
            const travelMinutes = (travel.hours * 60) + travel.minutes;
            const totalStopTime = stops.reduce((sum, stop) => sum + stop.time, 0);
            const totalTime = travelMinutes + totalStopTime;
            
            // Update basic results
            results.start.textContent = startPoint;
            results.end.textContent = endPoint;
            results.transport.textContent = transport;
            
            // Departure time
            if (departure.hours === 0 && departure.minutes === 0) {
                results.departureTime.textContent = '-';
                elements.arrivalSection.style.display = 'none';
            } else {
                results.departureTime.textContent = `${formatTimeNumber(departure.hours)}:${formatTimeNumber(departure.minutes)}`;
                
                // Calculate arrival time
                const arrival = calculateArrivalTime(departure.hours, departure.minutes, totalTime);
                results.arrivalTime.textContent = arrival.formatted;
                elements.arrivalSection.style.display = 'block';
            }
            
            // Travel times
            results.baseTime.textContent = minutesToHoursMinutes(travelMinutes);
            results.stopsCount.textContent = stops.length;
            results.totalStopTime.textContent = minutesToHoursMinutes(totalStopTime);
            results.totalTime.textContent = minutesToHoursMinutes(totalTime);
            
            // Fuel calculation
            if (elements.useFuelCalc.checked) {
                const fuelResult = calculateFuelCost();
                if (fuelResult) {
                    results.fuelCost.textContent = `${fuelResult.cost.toFixed(2)} บาท`;
                    results.fuelDetails.textContent = fuelResult.detail;
                    results.fuelCostResult.style.display = 'block';
                } else {
                    results.fuelCostResult.style.display = 'none';
                }
            } else {
                results.fuelCostResult.style.display = 'none';
            }
        }
        
        // Stop management
        function addStop() {
            const name = elements.stopName.value.trim();
            const time = parseInt(elements.stopTime.value) || 0;
            
            if (!name) {
                alert('กรุณากรอกชื่อจุดแวะพัก');
                elements.stopName.focus();
                return;
            }
            
            if (time <= 0) {
                alert('กรุณากรอกเวลาแวะพัก (มากกว่า 0 นาที)');
                elements.stopTime.focus();
                return;
            }
            
            stops.push({
                id: Date.now(),
                name,
                time
            });
            
            elements.stopName.value = '';
            elements.stopTime.value = '';
            
            updateStopsList();
            calculateTotalTime();
            
            // สั่นเล็กน้อยเมื่อเพิ่มสำเร็จ
            if (navigator.vibrate) navigator.vibrate(50);
        }
        
        function updateStopsList() {
            elements.stopsList.innerHTML = '';
            
            if (stops.length === 0) {
                elements.stopsList.appendChild(elements.emptyStopsMessage);
                return;
            }
            
            stops.forEach(stop => {
                const stopEl = document.createElement('div');
                stopEl.className = 'stop-item';
                stopEl.innerHTML = `
                    <div class="stop-details">
                        <div class="stop-name">${stop.name}</div>
                        <div class="stop-time">
                            <i class="fas fa-clock"></i> ${stop.time} นาที
                        </div>
                    </div>
                    <div class="stop-actions">
                        <button class="btn btn-secondary edit-stop" data-id="${stop.id}" style="padding: 8px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger delete-stop" data-id="${stop.id}" style="padding: 8px;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                
                elements.stopsList.appendChild(stopEl);
            });
            
            // Add event listeners
            document.querySelectorAll('.edit-stop').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = parseInt(btn.dataset.id);
                    editStop(id);
                });
            });
            
            document.querySelectorAll('.delete-stop').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const id = parseInt(btn.dataset.id);
                    deleteStop(id);
                });
            });
        }
        
        function editStop(id) {
            const stop = stops.find(s => s.id === id);
            if (!stop) return;
            
            elements.stopName.value = stop.name;
            elements.stopTime.value = stop.time;
            
            stops = stops.filter(s => s.id !== id);
            updateStopsList();
            calculateTotalTime();
            
            // สลับไปที่แท็บกรอกข้อมูล
            document.querySelector('[data-tab="stops"]').click();
            elements.stopName.focus();
        }
        
        function deleteStop(id) {
            if (confirm('ลบจุดแวะพักนี้?')) {
                stops = stops.filter(s => s.id !== id);
                updateStopsList();
                calculateTotalTime();
                
                if (navigator.vibrate) navigator.vibrate(30);
            }
        }
        
        function clearAllStops() {
            if (stops.length === 0) return;
            
            if (confirm('ลบจุดแวะพักทั้งหมด?')) {
                stops = [];
                updateStopsList();
                calculateTotalTime();
            }
        }
        
        function resetAll() {
            if (confirm('รีเซ็ตข้อมูลทั้งหมด?')) {
                elements.startPoint.value = 'A';
                elements.endPoint.value = 'B';
                elements.departureHour.value = '';
                elements.departureMinute.value = '';
                elements.travelHours.value = '';
                elements.travelMinutes.value = '';
                elements.transport.value = 'car';
                elements.useFuelCalc.checked = false;
                elements.fuelCostGroup.classList.remove('show');
                elements.distance.value = '';
                elements.fuelConsumption.value = '';
                
                stops = [];
                updateStopsList();
                calculateTotalTime();
                
                // กลับไปแท็บแรก
                document.querySelector('[data-tab="input"]').click();
            }
        }
        
        async function copyResults() {
            const text = `LogiTrip - ผลการเดินทาง
------------------------
จาก: ${results.start.textContent}
ไป: ${results.end.textContent}
เวลาเดินทาง: ${results.totalTime.textContent}
${results.arrivalTime.textContent !== '--:--' ? 'ถึงเวลา: ' + results.arrivalTime.textContent : ''}
${results.fuelCostResult.style.display !== 'none' ? 'ค่าน้ำมัน: ' + results.fuelCost.textContent : ''}
------------------------
คำนวณเมื่อ ${new Date().toLocaleString('th-TH')}`;
            
            try {
                await navigator.clipboard.writeText(text);
                alert('คัดลอกแล้ว!');
                
                const btn = document.getElementById('copyResultsBtn');
                btn.innerHTML = '<i class="fas fa-check"></i> คัดลอกแล้ว';
                setTimeout(() => {
                    btn.innerHTML = '<i class="fas fa-copy"></i> คัดลอกผลลัพธ์';
                }, 2000);
            } catch (err) {
                alert('ไม่สามารถคัดลอกได้');
            }
        }
        
        // Fetch fuel prices
        async function fetchFuelPrices() {
            try {
                // Simulate API call with realistic Thai fuel prices
                const mockPrices = {
                    '95': 35.94,
                    '91': 34.76,
                    'diesel': 33.94,
                    'e20': 34.54,
                    'e85': 30.29
                };
                
                fuelPrices = mockPrices;
                
                document.getElementById('price95').textContent = `${mockPrices['95'].toFixed(2)} บาท`;
                document.getElementById('price91').textContent = `${mockPrices['91'].toFixed(2)} บาท`;
                document.getElementById('priceDiesel').textContent = `${mockPrices['diesel'].toFixed(2)} บาท`;
            } catch (error) {
                console.log('Using default prices');
            }
        }
        
        // Event listeners
        function setupEventListeners() {
            // Input changes
            elements.startPoint.addEventListener('input', calculateTotalTime);
            elements.endPoint.addEventListener('input', calculateTotalTime);
            elements.transport.addEventListener('change', calculateTotalTime);
            
            elements.departureHour.addEventListener('input', () => {
                validateTimeInput(elements.departureHour, elements.departureMinute, 23);
                calculateTotalTime();
            });
            
            elements.departureMinute.addEventListener('input', () => {
                validateTimeInput(elements.departureHour, elements.departureMinute, 23);
                calculateTotalTime();
            });
            
            elements.travelHours.addEventListener('input', () => {
                validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
                calculateTotalTime();
            });
            
            elements.travelMinutes.addEventListener('input', () => {
                validateTimeInput(elements.travelHours, elements.travelMinutes, 99);
                calculateTotalTime();
            });
            
            // Fuel calculation
            elements.useFuelCalc.addEventListener('change', (e) => {
                if (e.target.checked) {
                    elements.fuelCostGroup.classList.add('show');
                } else {
                    elements.fuelCostGroup.classList.remove('show');
                    results.fuelCostResult.style.display = 'none';
                }
                calculateTotalTime();
            });
            
            elements.distance.addEventListener('input', calculateTotalTime);
            elements.fuelConsumption.addEventListener('input', calculateTotalTime);
            elements.fuelType.addEventListener('change', calculateTotalTime);
            
            // Buttons
            document.getElementById('addStopBtn').addEventListener('click', addStop);
            document.getElementById('clearStopsBtn').addEventListener('click', clearAllStops);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
            document.getElementById('calculateBtn').addEventListener('click', () => {
                calculateTotalTime();
                document.querySelector('[data-tab="results"]').click();
            });
            document.getElementById('copyResultsBtn').addEventListener('click', copyResults);
            
            // Enter key on stop inputs
            elements.stopName.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStop();
            });
            
            elements.stopTime.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addStop();
            });
        }
        
        // Initialize
        function init() {
            setupEventListeners();
            fetchFuelPrices();
            setInterval(fetchFuelPrices, 5 * 60 * 1000);
            updateStopsList();
            calculateTotalTime();
        }
        
        init();
    </script>
</body>
</html>
